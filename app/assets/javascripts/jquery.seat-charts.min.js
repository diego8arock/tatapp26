!function(t){t.fn.seatCharts=function(s){if(this.data("seatCharts"))return this.data("seatCharts");var a,e,n,i,r,c=this,h={},d=[],u={showLabel:!0,animate:!1,naming:{top:!0,left:!0,getId:function(t,s,a){return s+"_"+a},getLabel:function(t,s,a){return a}},legend:{node:null,items:[]},click:function(){return"available"==this.status()?"selected":"selected"==this.status()?"available":this.style()},focus:function(){return"available"==this.status()?"focused":this.style()},blur:function(){return this.status()},seats:{}},l=(a=c,e=u,function(s){var n,i,r,c,d,u=this;u.settings=t.extend({status:"available",style:"available",data:e.seats[s.character]||{}},s),u.settings.$node=t("<div></div>"),u.settings.$node.attr({id:u.settings.id,role:"checkbox","aria-checked":!1,focusable:!0,tabIndex:-1}).text(u.settings.label).addClass(["seatCharts-seat","seatCharts-cell","available"].concat(u.settings.classes,void 0===e.seats[u.settings.character]?[]:e.seats[u.settings.character].classes).join(" ")),u.data=function(){return u.settings.data},u.char=function(){return u.settings.character},u.node=function(){return u.settings.$node},u.style=function(){return 1==arguments.length?(t=arguments[0],s=u.settings.style,t==s?s:(u.settings.status="focused"!=t?t:u.settings.status,u.settings.$node.attr("aria-checked","selected"==t),e.animate?u.settings.$node.switchClass(s,t,200):u.settings.$node.removeClass(s).addClass(t),u.settings.style=t)):u.settings.style;var t,s},u.status=function(){return u.settings.status=1==arguments.length?u.style(arguments[0]):u.settings.status},n=e.seats,i=u.settings.character,r=u,t.each(["click","focus","blur"],function(t,s){u[s]=function(){return"focus"==s&&(void 0!==a.attr("aria-activedescendant")&&h[a.attr("aria-activedescendant")].blur(),a.attr("aria-activedescendant",r.settings.id),r.node().focus()),u.style("function"==typeof n[i][s]?n[i][s].apply(r):e[s].apply(r))}}),u.node().on("click",u.click).on("mouseenter",u.focus).on("mouseleave",u.blur).on("keydown",(c=u,d=u.node(),function(t){var s,e;switch(t.which){case 32:t.preventDefault(),c.click();break;case 40:case 38:if(t.preventDefault(),!(s=function a(e,n,i){var r;return r=e.index(i)||38!=t.which?e.index(i)==e.length-1&&40==t.which?e.first():e.eq(e.index(i)+(38==t.which?-1:1)):e.last(),(s=r.find(".seatCharts-seat,.seatCharts-space").eq(n.index(d))).hasClass("seatCharts-space")?a(e,n,r):s}(d.parents(".seatCharts-container").find(".seatCharts-row:not(.seatCharts-header)"),d.parents(".seatCharts-row:first").find(".seatCharts-seat,.seatCharts-space"),d.parents(".seatCharts-row:not(.seatCharts-header)"))).length)return;c.blur(),h[s.attr("id")].focus(),s.focus(),a.attr("aria-activedescendant",s.attr("id"));break;case 37:case 39:if(t.preventDefault(),e=d.parents(".seatCharts-container:first").find(".seatCharts-seat:not(.seatCharts-space)"),!(s=e.index(d)||37!=t.which?e.index(d)==e.length-1&&39==t.which?e.first():e.eq(e.index(d)+(37==t.which?-1:1)):e.last()).length)return;c.blur(),h[s.attr("id")].focus(),s.focus(),a.attr("aria-activedescendant",s.attr("id"))}}))});if(c.addClass("seatCharts-container"),t.extend(!0,u,s),u.naming.rows=u.naming.rows||function(t){for(var s=[],a=1;a<=t;a++)s.push(a);return s}(u.map.length),u.naming.columns=u.naming.columns||function(t){for(var s=[],a=1;a<=t;a++)s.push(a);return s}(u.map[0].split("").length),u.naming.top){var o=t("<div></div>").addClass("seatCharts-row seatCharts-header");u.naming.left&&o.append(t("<div></div>").addClass("seatCharts-cell")),t.each(u.naming.columns,function(s,a){o.append(t("<div></div>").addClass("seatCharts-cell").text(a))})}return c.append(o),t.each(u.map,function(s,a){var e=t("<div></div>").addClass("seatCharts-row");u.naming.left&&e.append(t("<div></div>").addClass("seatCharts-cell seatCharts-space")),t.each(a.match(/[a-z_]{1}(\[[0-9a-z_]{0,}(,[0-9a-z_ ]+)?\])?/gi),function(a,n){var i=n.match(/([a-z_]{1})(\[([0-9a-z_ ,]+)\])?/i),r=i[1],c=void 0!==i[3]?i[3].split(","):[],o=c.length?c[0]:null,f=2===c.length?c[1]:null;e.append("_"!=r?function(t){u.seats[r]=r in u.seats?u.seats[r]:{};var e=o||t.getId(r,t.rows[s],t.columns[a]);return h[e]=new l({id:e,label:0==u.showLabel?"":f||t.getLabel(r,t.rows[s],t.columns[a]),row:s,column:a,character:r}),d.push(e),h[e].node()}(u.naming):t("<div></div>").addClass("seatCharts-cell seatCharts-space"))}),c.append(e)}),u.legend.items.length&&(n=u.legend,i=(n.node||t("<div></div>").insertAfter(c)).addClass("seatCharts-legend"),r=t("<ul></ul>").addClass("seatCharts-legendList").appendTo(i),t.each(n.items,function(s,a){r.append(t("<li></li>").addClass("seatCharts-legendItem").append(t("<div></div>").addClass(["seatCharts-seat","seatCharts-cell",a[1]].concat(u.classes,void 0===u.seats[a[0]]?[]:u.seats[a[0]].classes).join(" "))).append(t("<span></span>").addClass("seatCharts-legendDescription").text(a[2])))})),c.attr({tabIndex:0}),c.focus(function(){c.attr("aria-activedescendant")&&h[c.attr("aria-activedescendant")].blur(),c.find(".seatCharts-seat:not(.seatCharts-space):first").focus(),h[d[0]].focus()}),c.data("seatCharts",{seats:h,seatIds:d,status:function(){var s,a,e=this;return 1==arguments.length?e.seats[arguments[0]].status():(s=arguments[0],a=arguments[1],"string"==typeof s?e.seats[s].status(a):void t.each(s,function(t,s){e.seats[s].status(a)}))},each:function(t){for(var s in this.seats)if(!1===t.call(this.seats[s],s))return s;return!0},node:function(){return t("#"+this.seatIds.join(",#"))},find:function(t){var s,a,e=this,n=e.set();return t instanceof RegExp?(e.each(function(s){s.match(t)&&n.push(s,this)}),n):1==t.length?(a=t,e.each(function(){this.char()==a&&n.push(this.settings.id,this)}),n):t.indexOf(".")>-1?(s=t.split("."),e.each(function(t){this.char()==s[0]&&this.status()==s[1]&&n.push(this.settings.id,this)}),n):(e.each(function(){this.status()==t&&n.push(this.settings.id,this)}),n)},set:function s(){var a=this;return{seats:[],seatIds:[],length:0,status:function(){var s=arguments,a=this;return 1==this.length&&0==s.length?this.seats[0].status():void t.each(a.seats,function(){this.status.apply(this,s)})},node:function(){return a.node.call(this)},each:function(){return a.each.call(this,arguments[0])},get:function(){return a.get.call(this,arguments[0])},find:function(){return a.find.call(this,arguments[0])},set:function(){return s.call(a)},push:function(t,s){this.seats.push(s),this.seatIds.push(t),++this.length}}},get:function(s){var a,e=this;return"string"==typeof s?e.seats[s]:(a=e.set(),t.each(s,function(t,s){"object"==typeof e.seats[s]&&a.push(s,e.seats[s])}),a)}}),c.data("seatCharts")}}(jQuery);
